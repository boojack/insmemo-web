var qe=Object.defineProperty,Ve=Object.defineProperties;var He=Object.getOwnPropertyDescriptors;var Ce=Object.getOwnPropertySymbols;var Ge=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var le=(n,e,a)=>e in n?qe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a,b=(n,e)=>{for(var a in e||(e={}))Ge.call(e,a)&&le(n,a,e[a]);if(Ce)for(var a of Ce(e))je.call(e,a)&&le(n,a,e[a]);return n},D=(n,e)=>Ve(n,He(e));var B=(n,e,a)=>(le(n,typeof e!="symbol"?e+"":e,a),a);import{j as ue,r as u,R as ae,P as be,T as We,a as Ye}from"./vendor.79e52d82.js";const Ke=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}};Ke();const t=ue.exports.jsx,i=ue.exports.jsxs,L=ue.exports.Fragment,xe=n=>{const{children:e,store:a,context:s}=n,[r,o]=u.exports.useState(a.getState());return u.exports.useEffect(()=>{const c=a.subscribe(l=>{o(l)});return()=>{c()}},[]),t(s.Provider,{value:r,children:e})};function ze(n){const e=Object.keys(n),a={};for(const s of e)typeof n[s]=="function"&&(a[s]=n[s]);return(s={},r)=>{let o=!1;const c={};for(const l of e){const g=s[l],N=a[l](g,r);c[l]=N,o=o||N!==g}return o?c:s}}function Je(n,e){const a=[];let s=n;return{dispatch:l=>{const g=e(s,l),N=s;s=g;for(const y of a)y(s,N)},getState:()=>s,subscribe:l=>{let g=!0;return a.push(l),()=>{if(!g)return;const N=a.indexOf(l);a.splice(N,1),g=!1}}}}function Xe(n,e){switch(e.type){case"SET_MARK_MEMO_ID":return e.payload.markMemoId===n.markMemoId?n:D(b({},n),{markMemoId:e.payload.markMemoId});case"SET_EDIT_MEMO_ID":return e.payload.editMemoId===n.editMemoId?n:D(b({},n),{editMemoId:e.payload.editMemoId});case"SET_MOBILE_VIEW":return e.payload.isMobileView===n.isMobileView?n:D(b({},n),{isMobileView:e.payload.isMobileView});case"SET_SHOW_SIDEBAR_IN_MOBILE_VIEW":return e.payload.showSiderbarInMobileView===n.showSiderbarInMobileView?n:D(b({},n),{showSiderbarInMobileView:e.payload.showSiderbarInMobileView});case"SET_APP_SETTING":return b(b({},n),e.payload);default:return n}}const Ze={markMemoId:"",editMemoId:"",shouldSplitMemoWord:!0,shouldHideImageUrl:!0,shouldUseMarkdownParser:!0,useTinyUndoHistoryCache:!1,isMobileView:!1,showSiderbarInMobileView:!1};function et(n,e){switch(e.type){case"SET_LOCATION":return e.payload;case"SET_PATHNAME":return e.payload.pathname===n.pathname?n:D(b({},n),{pathname:e.payload.pathname});case"SET_HASH":return e.payload.hash===n.hash?n:D(b({},n),{hash:e.payload.hash});case"SET_QUERY":return D(b({},n),{query:b({},e.payload)});case"SET_TAG_QUERY":return e.payload.tag===n.query.tag?n:D(b({},n),{query:D(b({},n.query),{tag:e.payload.tag})});case"SET_DURATION_QUERY":return e.payload.duration===n.query.duration?n:D(b({},n),{query:D(b({},n.query),{duration:b(b({},n.query.duration),e.payload.duration)})});case"SET_TYPE":return e.payload.type===n.query.type?n:D(b({},n),{query:D(b({},n.query),{type:e.payload.type})});case"SET_TEXT":return e.payload.text===n.query.text?n:D(b({},n),{query:D(b({},n.query),{text:e.payload.text})});case"SET_QUERY_FILTER":return e.payload===n.query.filter?n:D(b({},n),{query:D(b({},n.query),{filter:e.payload})});default:return n}}const tt={pathname:"/",hash:"",query:{tag:"",duration:null,type:"",text:"",filter:""}};var de;(function(n){function e(){return Date.now()}n.getNowTimeStamp=e;function a(){const f=navigator.userAgent;let E="Unknown";return f.indexOf("Win")!=-1?E="Windows":f.indexOf("Mac")!=-1?E="MacOS":f.indexOf("Linux")!=-1&&(E="Linux"),E}n.getOSVersion=a;function s(f){return typeof f=="string"&&(f=f.replaceAll("-","/")),new Date(f).getTime()}n.getTimeStampByDate=s;function r(f){const E=new Date(s(f));return new Date(E.getFullYear(),E.getMonth(),E.getDate()).getTime()}n.getDateStampByDate=r;function o(f){const E=new Date(s(f)),v=E.getFullYear(),k=E.getMonth()+1,w=E.getDate();return`${v}/${k}/${w}`}n.getDateString=o;function c(f){const E=new Date(s(f)),v=E.getHours(),k=E.getMinutes(),w=v<10?"0"+v:v,O=k<10?"0"+k:k;return`${w}:${O}`}n.getTimeString=c;function l(f){const E=new Date(s(f)),v=E.getFullYear(),k=E.getMonth()+1,w=E.getDate(),O=E.getHours(),G=E.getMinutes(),F=E.getSeconds(),q=k<10?"0"+k:k,ne=w<10?"0"+w:w,ie=O<10?"0"+O:O,Pe=G<10?"0"+G:G,Qe=F<10?"0"+F:F;return`${v}/${q}/${ne} ${ie}:${Pe}:${Qe}`}n.getDateTimeString=l;function g(f){return Array.from(new Set(f))}n.dedupe=g;function N(f){const E=new Set,v=[];for(const k of f)E.has(k.id)||(E.add(k.id),v.push(k));return v}n.dedupeObjectWithId=N;function y(f,E){let v=null;return()=>{v&&clearTimeout(v),v=setTimeout(f,E)}}n.debounce=y;function S(f,E){let v=!0;return()=>{if(!v)return!1;v=!1,setTimeout(()=>{f(),v=!0},E)}}n.throttle=S;function d(f){const E=[],v=Object.keys(f).sort();for(const k of v){const w=f[k];w&&(typeof w=="object"?E.push(...d(w).split("&")):E.push(`${k}=${w}`))}return E.join("&")}n.transformObjectToParamsString=d;function h(f){const E={},v=f.split("&");for(const k of v){const[w,O]=k.split("=");w&&O&&(E[w]=O)}return E}n.transformParamsStringToObject=h;function m(f){if(!f)return{};const E={},v=Object.keys(f).sort();for(const k of v){const w=f[k];if(typeof w=="object"){const O=m(JSON.parse(JSON.stringify(w)));O&&Object.keys(O).length>0&&(E[k]=O)}else Boolean(w)&&(E[k]=w)}return E}n.filterObjectNullKeys=m;async function p(f){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(f)}catch(E){console.warn("Copy to clipboard failed.",E)}else console.warn("Copy to clipboard failed, methods not supports.")}n.copyTextToClipboard=p;function C(f){return new Promise(E=>{const v=new Image;v.onload=()=>{const{width:k,height:w}=v;k>0&&w>0?E({width:k,height:w}):E({width:0,height:0})},v.onerror=()=>{E({width:0,height:0})},v.className="hidden",v.src=f,document.body.appendChild(v),v.remove()})}n.getImageSize=C})(de||(de={}));var x=de;function nt(n,e){switch(e.type){case"SET_MEMOS":{const a=x.dedupeObjectWithId(e.payload.memos.sort((s,r)=>x.getTimeStampByDate(r.createdAt)-x.getTimeStampByDate(s.createdAt)));return D(b({},n),{memos:[...a]})}case"SET_TAGS":return D(b({},n),{tags:e.payload.tags});case"INSERT_MEMO":{const a=x.dedupeObjectWithId([e.payload.memo,...n.memos].sort((s,r)=>x.getTimeStampByDate(r.createdAt)-x.getTimeStampByDate(s.createdAt)));return D(b({},n),{memos:a})}case"DELETE_MEMO_BY_ID":return D(b({},n),{memos:[...n.memos].filter(a=>a.id!==e.payload.id)});case"EDIT_MEMO":{const a=n.memos.map(s=>s.id===e.payload.id?b(b({},s),e.payload):s);return D(b({},n),{memos:a})}default:return n}}const at={memos:[],tags:[]};function st(n,e){switch(e.type){case"SIGN_IN":return{user:e.payload.user};case"SIGN_OUT":return{user:null};default:return n}}const rt={user:null};function ot(n,e){switch(e.type){case"SET_QUERIES":{const a=x.dedupeObjectWithId(e.payload.queries.sort((s,r)=>x.getTimeStampByDate(r.createdAt)-x.getTimeStampByDate(s.createdAt)).sort((s,r)=>{var o,c;return x.getTimeStampByDate((o=r.pinnedAt)!=null?o:0)-x.getTimeStampByDate((c=s.pinnedAt)!=null?c:0)}));return D(b({},n),{queries:a})}case"INSERT_QUERY":{const a=x.dedupeObjectWithId([e.payload.query,...n.queries].sort((s,r)=>x.getTimeStampByDate(r.createdAt)-x.getTimeStampByDate(s.createdAt)));return D(b({},n),{queries:a})}case"DELETE_QUERY_BY_ID":return D(b({},n),{queries:[...n.queries].filter(a=>a.id!==e.payload.id)});case"UPDATE_QUERY":{const a=n.queries.map(s=>s.id===e.payload.id?b(b({},s),e.payload):s);return D(b({},n),{queries:a})}default:return n}}const ct={queries:[]},T=Je({globalState:Ze,locationState:tt,memoState:at,userState:rt,queryState:ct},ze({globalState:Xe,locationState:et,memoState:nt,userState:st,queryState:ot})),$=u.exports.createContext(T.getState());var j;(function(n){function e(o){const c={};for(const l of o)try{const g=localStorage.getItem(l);if(g!==null){const N=JSON.parse(g);c[l]=N}}catch(g){console.error("Get storage failed in ",l,g)}return c}n.get=e;function a(o){for(const c in o)try{const l=JSON.stringify(o[c]);localStorage.setItem(c,l)}catch(l){console.error("Save storage failed in ",c,l)}}n.set=a;function s(o){for(const c of o)try{localStorage.removeItem(c)}catch(l){console.error("Remove storage failed in ",c,l)}}n.remove=s;function r(){var c;const o=document.createElement("iframe");o.style.display="none",document.body.appendChild(o),(c=o.contentWindow)==null||c.localStorage.setItem("t",Date.now().toString()),o.remove()}n.emitStorageChangedEvent=r})(j||(j={}));class it{constructor(){B(this,"getState",()=>T.getState().globalState);B(this,"setEditMemoId",e=>{T.dispatch({type:"SET_EDIT_MEMO_ID",payload:{editMemoId:e}})});B(this,"setMarkMemoId",e=>{T.dispatch({type:"SET_MARK_MEMO_ID",payload:{markMemoId:e}})});B(this,"setIsMobileView",e=>{T.dispatch({type:"SET_MOBILE_VIEW",payload:{isMobileView:e}})});B(this,"setShowSiderbarInMobileView",e=>{T.dispatch({type:"SET_SHOW_SIDEBAR_IN_MOBILE_VIEW",payload:{showSiderbarInMobileView:e}})});B(this,"setAppSetting",e=>{T.dispatch({type:"SET_APP_SETTING",payload:e}),j.set(e)});var s,r,o,c;const e=j.get(["shouldSplitMemoWord","shouldHideImageUrl","shouldUseMarkdownParser","useTinyUndoHistoryCache"]),a={shouldSplitMemoWord:(s=e.shouldSplitMemoWord)!=null?s:!0,shouldHideImageUrl:(r=e.shouldHideImageUrl)!=null?r:!0,shouldUseMarkdownParser:(o=e.shouldUseMarkdownParser)!=null?o:!0,useTinyUndoHistoryCache:(c=e.useTinyUndoHistoryCache)!=null?c:!1};this.setAppSetting(a)}}const R=new it,H=(n="replace")=>{const{query:e,pathname:a,hash:s}=T.getState().locationState;let r=x.transformObjectToParamsString(e);r?r="?"+r:r="",n==="replace"?window.history.replaceState(null,"",a+s+r):window.history.pushState(null,"",a+s+r)};class lt{constructor(){B(this,"updateStateWithLocation",()=>{var g,N,y,S,d,h;const{pathname:e,search:a,hash:s}=window.location,r=new URLSearchParams(a),o={pathname:"/",hash:"",query:{tag:"",duration:null,text:"",type:"",filter:""}};o.query.tag=(g=r.get("tag"))!=null?g:"",o.query.type=(N=r.get("type"))!=null?N:"",o.query.text=(y=r.get("text"))!=null?y:"",o.query.filter=(S=r.get("filter"))!=null?S:"";const c=parseInt((d=r.get("from"))!=null?d:"0"),l=parseInt((h=r.get("to"))!=null?h:"0");l>c&&l!==0&&(o.query.duration={from:c,to:l}),o.hash=s,o.pathname=this.getValidPathname(e),T.dispatch({type:"SET_LOCATION",payload:o})});B(this,"getState",()=>T.getState().locationState);B(this,"clearQuery",()=>{T.dispatch({type:"SET_QUERY",payload:{tag:"",duration:null,text:"",type:"",filter:""}}),H()});B(this,"setQuery",e=>{T.dispatch({type:"SET_QUERY",payload:e}),H()});B(this,"setHash",e=>{T.dispatch({type:"SET_HASH",payload:{hash:e}}),H()});B(this,"setPathname",e=>{T.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),H()});B(this,"pushHistory",e=>{T.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),H("push")});B(this,"replaceHistory",e=>{T.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),H("replace")});B(this,"setMemoTypeQuery",(e="")=>{T.dispatch({type:"SET_TYPE",payload:{type:e}}),H()});B(this,"setMemoFilter",e=>{T.dispatch({type:"SET_QUERY_FILTER",payload:e}),H()});B(this,"setTextQuery",e=>{T.dispatch({type:"SET_TEXT",payload:{text:e}}),H()});B(this,"setTagQuery",e=>{T.dispatch({type:"SET_TAG_QUERY",payload:{tag:e}}),H()});B(this,"setFromAndToQuery",(e,a)=>{T.dispatch({type:"SET_DURATION_QUERY",payload:{duration:{from:e,to:a}}}),H()});B(this,"getValidPathname",e=>["/","/signin","/recycle","/setting"].includes(e)?e:"/");this.updateStateWithLocation(),window.onpopstate=()=>{this.updateStateWithLocation()}}}const A=new lt;async function J(n){const a=await(await fetch(n,{method:"GET"})).json();if(!a.succeed)throw a;return a}async function P(n,e){const s=await(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(!s.succeed)throw s;return s}var me;(function(n){function e(){return J("/api/user/me")}n.getUserInfo=e;function a(F,q){return P("/api/user/signin",{username:F,password:q})}n.signin=a;function s(F,q){return P("/api/user/signup",{username:F,password:q})}n.signup=s;function r(){return P("/api/user/signout")}n.signout=r;function o(F){return J("/api/user/checkusername?username="+F)}n.checkUsernameUsable=o;function c(F){return P("/api/user/checkpassword",{password:F})}n.checkPasswordValid=c;function l(F,q,ne,ie){return P("/api/user/update",{username:F,password:q,githubName:ne,wxUserId:ie})}n.updateUserinfo=l;function g(){return J("/api/memo/all")}n.getMyMemos=g;function N(){return J("/api/memo/deleted")}n.getMyDeletedMemos=N;function y(F){return P("/api/memo/new",{content:F})}n.createMemo=y;function S(F){return J("/api/memo/?id="+F)}n.getMemoById=S;function d(F){return P("/api/memo/hide",{memoId:F})}n.hideMemo=d;function h(F){return P("/api/memo/restore",{memoId:F})}n.restoreMemo=h;function m(F){return P("/api/memo/delete",{memoId:F})}n.deleteMemo=m;function p(F,q){return P("/api/memo/update",{memoId:F,content:q})}n.updateMemo=p;function C(F){return J("/api/memo/linked?memoId="+F)}n.getLinkedMemos=C;function f(){return P("/api/user/updategh",{githubName:""})}n.removeGithubName=f;function E(){return J("/api/query/all")}n.getMyQueries=E;function v(F,q){return P("/api/query/new",{title:F,querystring:q})}n.createQuery=v;function k(F,q,ne){return P("/api/query/update",{queryId:F,title:q,querystring:ne})}n.updateQuery=k;function w(F){return P("/api/query/delete",{queryId:F})}n.deleteQueryById=w;function O(F){return P("/api/query/pin",{queryId:F})}n.pinQuery=O;function G(F){return P("/api/query/unpin",{queryId:F})}n.unpinQuery=G})(me||(me={}));var _=me;const ve="mobile-show-sidebar",we=200,ut=400,W=3600*24*1e3,Z=/#\s(.+?)\s/g,oe=/(https?:\/\/[^\s<\\*>']+)/g,Y=/(https?:\/\/[^\s<\\*>']+\.(jpeg|jpg|gif|png|svg))/g,se=/\[@(.+?)\]\((.+?)\)/g;class dt{getState(){return T.getState().userState}async doSignIn(){const{data:e}=await _.getUserInfo();return e?T.dispatch({type:"SIGN_IN",payload:{user:e}}):U.doSignOut(),e}async doSignOut(){T.dispatch({type:"SIGN_OUT",payload:null}),_.signout().catch(()=>{})}async checkUsernameUsable(e){const{data:a}=await _.checkUsernameUsable(e);return a}async updateUsername(e){await _.updateUserinfo(e)}async removeGithubName(){await _.updateUserinfo(void 0,void 0,"")}async checkPasswordValid(e){const{data:a}=await _.checkPasswordValid(e);return a}async updatePassword(e){await _.updateUserinfo(void 0,e)}async updateWxUserId(e){await _.updateUserinfo(void 0,void 0,void 0,e)}}const U=new dt;class mt{constructor(){B(this,"initialized",!1)}getState(){return T.getState().memoState}async fetchAllMemos(){if(!U.getState().user)return!1;const{data:e}=await _.getMyMemos(),a=[];for(const s of e)a.push(s);return T.dispatch({type:"SET_MEMOS",payload:{memos:a}}),this.initialized||(this.initialized=!0),a}async fetchDeletedMemos(){if(!U.getState().user)return!1;const{data:e}=await _.getMyDeletedMemos();return e}pushMemo(e){T.dispatch({type:"INSERT_MEMO",payload:{memo:b({},e)}})}getMemoById(e){for(const a of this.getState().memos)if(a.id===e)return a;return null}async hideMemoById(e){await _.hideMemo(e),T.dispatch({type:"DELETE_MEMO_BY_ID",payload:{id:e}})}async restoreMemoById(e){await _.restoreMemo(e),I.clearMemos(),I.fetchAllMemos()}async deleteMemoById(e){await _.deleteMemo(e)}editMemo(e){T.dispatch({type:"EDIT_MEMO",payload:e})}updateTagsState(){var s;const{memos:e}=this.getState(),a=new Set;for(const r of e)for(const o of Array.from((s=r.content.match(Z))!=null?s:[]))a.add(o.replace(Z,"$1").trim());T.dispatch({type:"SET_TAGS",payload:{tags:Array.from(a)}})}clearMemos(){T.dispatch({type:"SET_MEMOS",payload:{memos:[]}})}async createMemo(e){const{data:a}=await _.createMemo(e);return a}async updateMemo(e,a){const{data:s}=await _.updateMemo(e,a);return s}async getLinkedMemos(e){const{data:a}=await _.getLinkedMemos(e);return a}}const I=new mt;class ht{getState(){return T.getState().queryState}async getMyAllQueries(){if(!U.getState().user)return!1;const{data:e}=await _.getMyQueries();return T.dispatch({type:"SET_QUERIES",payload:{queries:e}}),e}getQueryById(e){for(const a of this.getState().queries)if(a.id===e)return a}pushQuery(e){T.dispatch({type:"INSERT_QUERY",payload:{query:b({},e)}})}editQuery(e){T.dispatch({type:"UPDATE_QUERY",payload:e})}async deleteQuery(e){await _.deleteQueryById(e),T.dispatch({type:"DELETE_QUERY_BY_ID",payload:{id:e}})}async createQuery(e,a){const{data:s}=await _.createQuery(e,a);return s}async updateQuery(e,a,s){const{data:r}=await _.updateQuery(e,a,s);return r}async pinQuery(e){await _.pinQuery(e)}async unpinQuery(e){await _.unpinQuery(e)}}const V=new ht;const pt=n=>{const{children:e,className:a,clickSpaceDestroy:s,destroy:r}=n,o=()=>{s&&r()};return t("div",{className:`dialog-wrapper ${a}`,onClick:o,children:t("div",{className:"dialog-container",onClick:c=>c.stopPropagation(),children:e})})};function K(n,e,a){const s=document.createElement("div");document.body.append(s),setTimeout(()=>{var l;(l=s.firstElementChild)==null||l.classList.add("showup")},0);const r={destroy:()=>{var l,g;(l=s.firstElementChild)==null||l.classList.remove("showup"),(g=s.firstElementChild)==null||g.classList.add("showoff"),setTimeout(()=>{s.remove(),ae.unmountComponentAtNode(s)},we)}},o=D(b({},a),{destroy:r.destroy});let c=t(pt,D(b({destroy:r.destroy,clickSpaceDestroy:!0},n),{children:t(e,b({},o))}));return n.useAppContext&&(c=t(xe,{store:T,context:$,children:c})),ae.render(c,s),r}const gt=({destroy:n})=>i(L,{children:[i("div",{className:"dialog-header-container",children:[i("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F920}"}),"\u5173\u4E8E ",t("b",{children:"Memos"})]}),t("button",{className:"btn close-btn",onClick:()=>{n()},children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),i("div",{className:"dialog-content-container",children:[t("p",{children:"\u4E00\u4E2A\u788E\u7247\u5316\u77E5\u8BC6\u8BB0\u5F55\u5DE5\u5177\u3002"}),t("br",{}),t("i",{children:"\u4E3A\u4F55\u505A\u8FD9\u4E2A\uFF1F"}),i("ul",{children:[i("li",{children:["\u5B9E\u8DF5 ",t("strong",{children:"\u5362\u66FC\u5361\u7247\u76D2\u7B14\u8BB0\u6CD5"}),"\uFF1B"]}),t("li",{children:"\u7528\u4E8E\u8BB0\u5F55\uFF1A\u{1F4C5} \u6BCF\u65E5/\u5468\u8BA1\u5212\u3001\u{1F4A1} \u7A81\u53D1\u5947\u60F3\u3001\u{1F4D5} \u8BFB\u540E\u611F..."}),t("li",{children:"\u4EE3\u66FF\u4E86\u6211\u5728\u5FAE\u4FE1\u4E0A\u7ECF\u5E38\u4F7F\u7528\u7684\u201C\u6587\u4EF6\u4F20\u8F93\u52A9\u624B\u201D\uFF1B"}),t("li",{children:"\u6253\u9020\u4E00\u4E2A\u5C5E\u4E8E\u81EA\u5DF1\u7684\u8F7B\u91CF\u5316\u201C\u5361\u7247\u201D\u7B14\u8BB0\u7C3F\uFF1B"})]}),t("br",{}),t("i",{children:"\u6709\u4F55\u7279\u70B9\u5462\uFF1F"}),i("ul",{children:[i("li",{children:["\u2728"," ",t("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web",rel:"noreferrer",children:"\u5F00\u6E90\u9879\u76EE"})]}),t("li",{children:"\u{1F60B} \u7CBE\u7F8E\u4E14\u7EC6\u8282\u7684\u89C6\u89C9\u6837\u5F0F\uFF1B"}),t("li",{children:"\u{1F4D1} \u4F53\u9A8C\u4F18\u826F\u7684\u4EA4\u4E92\u903B\u8F91\uFF1B"})]}),t("br",{}),t("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web/discussions",rel:"noreferrer",children:"\u{1F914} \u95EE\u9898\u53CD\u9988"}),t("br",{}),t("p",{children:"Enjoy it and have fun~ "}),t("hr",{}),i("p",{className:"normal-text",children:["Last updated on ",t("span",{className:"pre-text",children:"2021/11/26 16:17:44"})," \u{1F389}"]})]})]});function De(){K({className:"about-site-dialog"},gt)}const ft=n=>{const{shownStatus:e,setShownStatus:a}=n,s=u.exports.useRef(null);u.exports.useEffect(()=>{if(e){const g=N=>{var y;((y=s.current)==null?void 0:y.contains(N.target))||N.stopPropagation(),a(!1)};window.addEventListener("click",g,{capture:!0,once:!0})}},[e]);const r=()=>{A.pushHistory("/setting")},o=()=>{A.pushHistory("/recycle")},c=()=>{De()},l=async()=>{await U.doSignOut(),A.replaceHistory("/signin")};return i("div",{className:`menu-btns-popup ${e?"":"hidden"}`,ref:s,children:[i("button",{className:"btn action-btn",onClick:r,children:[t("span",{className:"icon",children:"\u{1F464}"})," \u8D26\u53F7\u4E0E\u8BBE\u7F6E"]}),i("button",{className:"btn action-btn",onClick:o,children:[t("span",{className:"icon",children:"\u{1F5D1}\uFE0F"})," \u56DE\u6536\u7AD9"]}),i("button",{className:"btn action-btn",onClick:c,children:[t("span",{className:"icon",children:"\u{1F920}"})," \u5173\u4E8E"]}),i("button",{className:"btn action-btn",onClick:l,children:[t("span",{className:"icon",children:"\u{1F44B}"})," \u9000\u51FA"]})]})},he=new Map;function Fe(n,e=!0){return e&&he.has(n)?Promise.resolve(he.get(n)):new Promise(async a=>{const r=await(await fetch(n)).blob();var o=new FileReader;o.onloadend=()=>{const c=o.result;he.set(n,c),a(c)},o.readAsDataURL(r)})}async function yt(n){const e=document.createElement(n.tagName);e.innerHTML=n.innerHTML;const a=async(s,r)=>{var c;if(!s||!r)return;const o=window.getComputedStyle(s);if(s.tagName==="IMG")try{const l=await Fe((c=s.getAttribute("src"))!=null?c:"");r.src=l}catch{}for(const l of o)r.style.setProperty(l,o.getPropertyValue(l),o.getPropertyPriority(l));for(let l=0;l<r.childElementCount;l++)await a(s.children[l],r.children[l])};return await a(n,e),e}async function St(n){const e=n.ownerDocument.styleSheets,a=[];for(const r of e)for(const o of r.cssRules)o.constructor.name==="CSSFontFaceRule"&&a.push(o.style);const s=document.createElement("style");for(const r of a){const o=r.getPropertyValue("font-family"),c=r.getPropertyValue("font-weight"),g=r.getPropertyValue("src").split(",").map(y=>y.replace(/url\("?(.+?)"?\)/,"$1"));let N=[];for(const y of g)try{const S=await Fe(y);N.push(`url("${S}")`)}catch{}s.innerHTML+=`
      @font-face {
        font-family: "${o}";
        src: ${N.join(",")};
        font-weight: ${c};
      }`}return s}function Me(n){const{width:e,height:a}=window.getComputedStyle(n);return{width:parseInt(e.replace("px","")),height:parseInt(a.replace("px",""))}}function Nt(n){const e=new XMLSerializer().serializeToString(n);return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)}`}function Et(n,e,a){const s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"svg");r.setAttribute("width",`${n}`),r.setAttribute("height",`${e}`),r.setAttribute("viewBox",`0 0 ${n} ${e}`);const o=document.createElementNS(s,"foreignObject");return o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),o.appendChild(a),r.appendChild(o),r}async function Ct(n,e){const{width:a,height:s}=Me(n),r=await yt(n);(e==null?void 0:e.backgroundColor)&&(r.style.backgroundColor=e.backgroundColor);const o=Et(a,s,r);return o.prepend(await St(n)),Nt(o)}async function bt(n,e){const a=await Ct(n,e),s=new Image;s.src=a;const r=document.createElement("canvas"),o=r.getContext("2d"),c=(e==null?void 0:e.pixelRatio)||1,{width:l,height:g}=Me(n);return r.width=l*c,r.height=g*c,r.style.width=`${l}`,r.style.height=`${g}`,(e==null?void 0:e.backgroundColor)&&(o.fillStyle=e.backgroundColor,o.fillRect(0,0,r.width,r.height)),new Promise(N=>{s.onload=()=>{o.drawImage(s,0,0,r.width,r.height),N(r)}})}async function Te(n,e){return(await bt(n,e)).toDataURL()}function X(n=!1){const[e,a]=u.exports.useState(n),s=u.exports.useCallback(r=>{a(r!==void 0?r:o=>!o)},[]);return[e,s]}function ee(n=!0){const[e,a]=u.exports.useState({isLoading:n,isFailed:!1,isSucceed:!1});return D(b({},e),{setLoading:()=>{a(D(b({},e),{isLoading:!0,isFailed:!1,isSucceed:!1}))},setFinish:()=>{a(D(b({},e),{isLoading:!1,isFailed:!1,isSucceed:!0}))},setError:()=>{a(D(b({},e),{isLoading:!1,isFailed:!0,isSucceed:!1}))}})}const xt=({destroy:n,imgUrl:e})=>{const a=u.exports.useRef(null),[s,r]=u.exports.useState(-1);u.exports.useEffect(()=>{x.getImageSize(e).then(({width:g})=>{r(g!==0?80:0)})},[]);const o=()=>{n()},c=()=>{s>30&&r(s-10)},l=()=>{r(s+10)};return i(L,{children:[t("button",{className:"btn close-btn",onClick:o,children:t("img",{className:"icon-img",src:"/icons/close.svg"})}),i("div",{className:"img-container",children:[t("img",{className:s<=0?"hidden":"",ref:a,width:s+"%",src:e}),t("span",{className:"loading-text "+(s===-1?"":"hidden"),children:"\u56FE\u7247\u52A0\u8F7D\u4E2D..."}),t("span",{className:"loading-text "+(s===0?"":"hidden"),children:"\u{1F61F} \u56FE\u7247\u52A0\u8F7D\u5931\u8D25\uFF0C\u53EF\u80FD\u662F\u65E0\u6548\u7684\u94FE\u63A5"})]}),i("div",{className:"action-btns-container",children:[t("button",{className:"btn",onClick:c,children:"\u2796"}),t("button",{className:"btn",onClick:l,children:"\u2795"}),t("button",{className:"btn",onClick:()=>r(80),children:"\u2B55"})]})]})};function ke(n){K({className:"preview-image-dialog"},xt,{imgUrl:n})}const vt=/```([\s\S]*?)```/g,wt=/\*\*(.+?)\*\*/g,Dt=/\*(.+?)\*/g,Ft=/\[ \] /g,Mt=/\[x\] /g,Tt=/[*] /g,kt=/(\d+)\. /g,At=n=>{const e=/^\w+/g.exec(n);return e!==null?e[0]:"javascript"},Bt=n=>n.replace(vt,(e,a)=>{const s=At(a);let r=a.replace(s,"").replace(/<p>/g,"").replace(/<\/p>/g,`\r
`).replace(/<br>/g,`\r
`).replace(/&nbsp;/g," ");switch(s){case"html":r=r.replace(/&lt;/g,"<").replace(/&gt;/g,">")}try{return`<pre>${be.highlight(r,be.languages[s],s)}</pre>`}catch{}return`<pre>${n}</pre>`}),It=n=>Bt(n).replace(Tt,"<span class='counter-block'>\u25E6</span>").replace(kt,"<span class='counter-block'>$1.</span>").replace(Ft,"<span class='todo-block' data-type='todo'>\u2B1C</span>").replace(Mt,"<span class='todo-block' data-type='done'>\u2705</span>").replace(wt,"<strong>$1</strong>").replace(Dt,"<em>$1</em>"),pe=n=>{const e=document.createElement("div");return e.className="memo-content-text",e.innerHTML=n,e.innerText},Lt=n=>n.replace(/\n/g,"<br>"),Ot=n=>{const e=document.createElement("div");return e.textContent=n,e.innerHTML},_t=n=>{const{children:e,when:a}=n;return a?t(L,{children:e}):null},Q=_t;const ge=n=>{const{className:e,imgUrl:a}=n,s=()=>{ke(a)};return t("div",{className:"image-container "+e,onClick:s,children:t("img",{src:a,decoding:"async",loading:"lazy"})})};const Ut=n=>{const{destory:e,duration:a}=n;return u.exports.useEffect(()=>{a>0&&setTimeout(()=>{e()},a)},[]),t("div",{className:"toast-container",onClick:e,children:t("p",{className:"content-text",children:n.content})})};class Rt{constructor(){B(this,"shownToastAmount",0);B(this,"toastWrapper");B(this,"shownToastContainers",[]);B(this,"info",(e,a=3e3)=>this.showToast({type:"normal",content:e,duration:a}));B(this,"success",(e,a=3e3)=>this.showToast({type:"success",content:e,duration:a}));B(this,"error",(e,a=3e3)=>this.showToast({type:"error",content:e,duration:a}));B(this,"showToast",e=>{const a=document.createElement("div");a.className=`toast-wrapper ${e.type}`,this.toastWrapper.appendChild(a),this.shownToastAmount++,this.shownToastContainers.push(a),setTimeout(()=>{a.classList.add("showup")},0);const s={destory:()=>{a.classList.add("destory"),setTimeout(()=>{if(!!a.parentElement&&(this.shownToastAmount--,this.shownToastAmount===0)){for(const r of this.shownToastContainers)ae.unmountComponentAtNode(r),r.remove();this.shownToastContainers.splice(0,this.shownToastContainers.length)}},ut)}};return ae.render(t(Ut,D(b({},e),{destory:s.destory})),a),s});const e="toast-list-container",a=document.createElement("div");a.className=e,document.body.appendChild(a),this.toastWrapper=a}}const M=new Rt;const $t=n=>{var S;const[e,a]=u.exports.useState(D(b({},n.memo),{createdAtStr:x.getDateTimeString(n.memo.createdAt)})),[s,r]=u.exports.useState([]),[o,c]=u.exports.useState([]),l=Array.from((S=e.content.match(Y))!=null?S:[]);u.exports.useEffect(()=>{(async()=>{try{const h=[],m=[...e.content.matchAll(se)];for(const C of m)if(C&&C.length===3){const f=C[2],E=I.getMemoById(f);E&&h.push(D(b({},E),{createdAtStr:x.getDateTimeString(E.createdAt),dateStr:x.getDateString(E.createdAt)}))}r([...h]);const p=await I.getLinkedMemos(e.id);c(p.sort((C,f)=>x.getTimeStampByDate(f.createdAt)-x.getTimeStampByDate(C.createdAt)).map(C=>D(b({},C),{createdAtStr:x.getDateTimeString(C.createdAt),dateStr:x.getDateString(C.createdAt)})))}catch{}})()},[e.id]);const g=u.exports.useCallback(async d=>{var m;const h=d.target;if(h.className==="memo-link-text"){const p=(m=h.dataset)==null?void 0:m.value,C=I.getMemoById(p!=null?p:"");if(C){const f=D(b({},C),{createdAtStr:x.getDateTimeString(C.createdAt)});r([]),c([]),a(f)}else M.error("MEMO Not Found"),h.classList.remove("memo-link-text")}},[]),N=u.exports.useCallback(d=>{r([]),c([]),a(d)},[]),y=u.exports.useCallback(()=>{n.destroy(),R.setEditMemoId(e.id)},[e.id]);return i(L,{children:[i("div",{className:"memo-card-container",children:[i("div",{className:"header-container",children:[t("p",{className:"time-text",children:e.createdAtStr}),i("div",{className:"btns-container",children:[t("button",{className:"btn edit-btn",onClick:y,children:t("img",{className:"icon-img",src:"/icons/edit.svg"})}),t("button",{className:"btn close-btn",onClick:n.destroy,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]})]}),i("div",{className:"memo-container",children:[t("div",{className:"memo-content-text",onClick:g,dangerouslySetInnerHTML:{__html:z(e.content)}}),t(Q,{when:l.length>0,children:t("div",{className:"images-wrapper",children:l.map((d,h)=>t(ge,{className:"memo-img",imgUrl:d},h))})})]}),t("div",{className:"layer-container"}),s.map((d,h)=>h<4?t("div",{className:"background-layer-container",style:{bottom:(h+1)*-3+"px",left:(h+1)*5+"px",width:`calc(100% - ${(h+1)*10}px)`,zIndex:-h-1}},h):null)]}),s.length>0?i("div",{className:"linked-memos-wrapper",children:[i("p",{className:"normal-text",children:["\u5173\u8054\u4E86 ",s.length," \u4E2A MEMO"]}),s.map(d=>{const h=pe(z(d.content)).replaceAll(`
`," ");return i("div",{className:"linked-memo-container",onClick:()=>N(d),children:[i("span",{className:"time-text",children:[d.dateStr," "]}),h]},d.id)})]}):null,o.length>0?i("div",{className:"linked-memos-wrapper",children:[i("p",{className:"normal-text",children:[o.length," \u4E2A\u94FE\u63A5\u81F3\u6B64\u7684 MEMO"]}),o.map(d=>{const h=pe(z(d.content)).replaceAll(`
`," ");return i("div",{className:"linked-memo-container",onClick:()=>N(d),children:[i("span",{className:"time-text",children:[d.dateStr," "]}),h]},d.id)})]}):null]})};function Ae(n){K({className:"memo-card-dialog"},$t,{memo:n})}const Pt=n=>{var h;const{memo:e,destroy:a}=n,{user:s}=U.getState(),r=D(b({},e),{createdAtStr:x.getDateTimeString(e.createdAt)}),o=Array.from((h=r.content.match(Y))!=null?h:[]),[c,l]=u.exports.useState(""),[g,N]=u.exports.useState(o.length),y=u.exports.useRef(null);u.exports.useEffect(()=>{g>0||setTimeout(()=>{!y.current||Te(y.current,{backgroundColor:"#eaeaea",pixelRatio:window.devicePixelRatio*2}).then(m=>{l(m)}).catch(()=>{})},we)},[g]);const S=()=>{a()},d=m=>{m.type==="error"&&(M.error("\u6709\u4E2A\u56FE\u7247\u52A0\u8F7D\u5931\u8D25\u4E86\u{1F61F}"),m.target.remove()),N(g-1)};return i(L,{children:[i("div",{className:"dialog-header-container",children:[i("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F970}"}),"\u5206\u4EAB Memo \u56FE\u7247"]}),t("button",{className:"btn close-btn",onClick:S,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),i("div",{className:"dialog-content-container",children:[t("div",{className:`tip-words-container ${c?"finish":"loading"}`,children:t("p",{className:"tip-text",children:c?"\u53F3\u952E\u6216\u957F\u6309\u5373\u53EF\u4FDD\u5B58\u56FE\u7247 \u{1F447}":"\u56FE\u7247\u751F\u6210\u4E2D..."})}),i("div",{className:"memo-container",ref:y,children:[t(Q,{when:c!=="",children:t("img",{className:"memo-shortcut-img",src:c})}),t("span",{className:"time-text",children:r.createdAtStr}),t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:z(r.content)}}),t(Q,{when:o.length>0,children:t("div",{className:"images-container",children:o.map((m,p)=>t("img",{crossOrigin:"anonymous",decoding:"async",src:m,onLoad:d,onError:d},p))})}),t("div",{className:"watermark-container",children:i("span",{className:"normal-text",children:[t("span",{className:"icon-text",children:"\u270D\uFE0F"})," by ",t("span",{className:"name-text",children:s==null?void 0:s.username})]})})]})]})]})};function Qt(n){K({className:"share-memo-image-dialog"},Pt,{memo:n})}const qt=n=>{var h;const{memo:e}=n,a=D(b({},e),{createdAtStr:x.getDateTimeString(e.createdAt)}),[s,r]=X(!1),o=Array.from((h=a.content.match(Y))!=null?h:[]),c=()=>{Ae(a)},l=()=>{R.setMarkMemoId(a.id)},g=()=>{R.setEditMemoId(a.id)},N=async()=>{if(s){try{await I.hideMemoById(a.id)}catch(m){M.error(m.message)}R.getState().editMemoId===a.id&&R.setEditMemoId("")}else r()},y=()=>{s&&r(!1)},S=()=>{Qt(a)},d=async m=>{var C;const p=m.target;if(p.className==="memo-link-text"){const f=(C=p.dataset)==null?void 0:C.value,E=I.getMemoById(f!=null?f:"");E?Ae(E):(M.error("MEMO Not Found"),p.classList.remove("memo-link-text"))}else p.className==="todo-block"};return i("div",{className:`memo-wrapper ${"memos-"+a.id}`,onMouseLeave:y,children:[i("div",{className:"memo-top-wrapper",children:[t("span",{className:"time-text",onClick:c,children:a.createdAtStr}),i("div",{className:"btns-container",children:[t("span",{className:"btn more-action-btn",children:t("img",{className:"icon-img",src:"/icons/more.svg"})}),t("div",{className:"more-action-btns-wrapper",children:i("div",{className:"more-action-btns-container",children:[t("span",{className:"btn",onClick:c,children:"\u67E5\u770B\u8BE6\u60C5"}),t("span",{className:"btn",onClick:l,children:"Mark"}),t("span",{className:"btn",onClick:S,children:"\u5206\u4EAB"}),t("span",{className:"btn",onClick:g,children:"\u7F16\u8F91"}),t("span",{className:`btn delete-btn ${s?"final-confirm":""}`,onClick:N,children:s?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"})]})})]})]}),t("div",{className:"memo-content-text",onClick:d,dangerouslySetInnerHTML:{__html:z(a.content)}}),t(Q,{when:o.length>0,children:t("div",{className:"images-wrapper",children:o.map((m,p)=>t(ge,{className:"memo-img",imgUrl:m},p))})})]})};function z(n){var o;n=Ot(n),n=Lt(n).split("<br>").map(c=>`<p>${c!==""?c:"<br>"}</p>`).join("");const{shouldUseMarkdownParser:e,shouldSplitMemoWord:a,shouldHideImageUrl:s}=R.getState();e&&(n=It(n)),s&&(n=n.replace(Y,"")),a&&(n=n.replace(/([\u4e00-\u9fa5])([A-Za-z0-9?.,;[\]]+)/g,"$1 $2").replace(/([A-Za-z0-9?.,;[\]]+)([\u4e00-\u9fa5])/g,"$1 $2")),n=n.replace(Z,"<span class='tag-span'>#$1</span>").replace(oe,"<a class='link' target='_blank' rel='noreferrer' href='$1'>$1</a>").replace(se,"<span class='memo-link-text' data-value='$2'>$1</span>");const r=document.createElement("div");r.innerHTML=n;for(let c=0;c<r.children.length;c++){const l=r.children[c];if(l.tagName==="P"&&l.textContent===""&&((o=l.firstElementChild)==null?void 0:o.tagName)!=="BR"){l.remove(),c--;continue}}return r.innerHTML}var Vt=u.exports.memo(qt);const Ht=n=>{var r;const{memo:e}=n,a=D(b({},e),{createdAtStr:x.getDateTimeString(e.createdAt),timeStr:x.getTimeString(e.createdAt)}),s=Array.from((r=a.content.match(Y))!=null?r:[]);return i("div",{className:"daily-memo-wrapper",children:[t("div",{className:"time-wrapper",children:t("span",{className:"normal-text",children:a.timeStr})}),i("div",{className:"memo-content-container",children:[t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:z(a.content)}}),t(Q,{when:s.length>0,children:t("div",{className:"images-container",children:s.map((o,c)=>t("img",{crossOrigin:"anonymous",src:o,decoding:"async"},c))})})]})]})};const Gt=n=>{const{className:e,datestamp:a,handleDateStampChange:s}=n,[r,o]=u.exports.useState(fe(a));u.exports.useEffect(()=>{o(fe(a))},[a]);const c=new Date(r),l=c.getDay()===0?7:c.getDay(),g=[];for(let d=1;d<l;d++)g.push({date:0,datestamp:c.getTime()-W*(7-d)});const N=jt(r);for(let d=1;d<=N;d++)g.push({date:d,datestamp:c.getTime()+W*(d-1)});const y=d=>{s(d)},S=d=>{const h=c.getFullYear(),m=c.getMonth()+1;let p=0;m===1&&d===-1?p=new Date(`${h-1}/12/1`).getTime():m===12&&d===1?p=new Date(`${h+1}/1/1`).getTime():p=new Date(`${h}/${m+d}/1`).getTime(),o(fe(p))};return i("div",{className:`date-picker-wrapper ${e}`,children:[i("div",{className:"date-picker-header",children:[t("span",{className:"btn-text",onClick:()=>S(-1),children:t("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),i("span",{className:"normal-text",children:[c.getFullYear()," \u5E74 ",c.getMonth()+1," \u6708"]}),t("span",{className:"btn-text",onClick:()=>S(1),children:t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),i("div",{className:"date-picker-day-container",children:[i("div",{className:"date-picker-day-header",children:[t("span",{className:"day-item",children:"\u5468\u4E00"}),t("span",{className:"day-item",children:"\u5468\u4E8C"}),t("span",{className:"day-item",children:"\u5468\u4E09"}),t("span",{className:"day-item",children:"\u5468\u56DB"}),t("span",{className:"day-item",children:"\u5468\u4E94"}),t("span",{className:"day-item",children:"\u5468\u516D"}),t("span",{className:"day-item",children:"\u5468\u65E5"})]}),g.map(d=>d.date===0?t("span",{className:"day-item null",children:""},d.datestamp):t("span",{className:`day-item ${d.datestamp===a?"current":""}`,onClick:()=>y(d.datestamp),children:d.date},d.datestamp))]})]})};function jt(n){const e=new Date(n),a=new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`);return((a.getMonth()===11?new Date(`${a.getFullYear()+1}/1/1`):new Date(`${a.getFullYear()}/${a.getMonth()+2}/1`)).getTime()-a.getTime())/W}function fe(n){const e=new Date(n);return new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`).getTime()}const Wt=["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],Yt=["\u5468\u65E5","\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D"],Kt=n=>{const e=ee(),[a,s]=u.exports.useState([]),[r,o]=u.exports.useState(x.getDateStampByDate(x.getDateString(n.currentDateStamp))),[c,l]=X(!1),g=u.exports.useRef(null),N=new Date(r);u.exports.useEffect(()=>{(()=>{const h=I.getState().memos.filter(m=>x.getTimeStampByDate(m.createdAt)>=r&&x.getTimeStampByDate(m.createdAt)<r+W).sort((m,p)=>x.getTimeStampByDate(m.createdAt)-x.getTimeStampByDate(p.createdAt));s(h),e.setFinish()})()},[r]);const y=()=>{l(!1),setTimeout(()=>{!g.current||Te(g.current,{backgroundColor:"#ffffff",pixelRatio:window.devicePixelRatio*2}).then(d=>{ke(d)}).catch(()=>{})},0)},S=d=>{o(d),l(!1)};return i(L,{children:[t("div",{className:"dialog-header-container",children:i("div",{className:"header-wrapper",children:[t("p",{className:"title-text",children:"Daily Memos"}),i("div",{className:"btns-container",children:[t("span",{className:"btn-text",onClick:()=>o(r-W),children:t("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),t("span",{className:"btn-text",onClick:()=>o(r+W),children:t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})}),t("span",{className:"btn-text share-btn",onClick:y,children:t("img",{className:"icon-img",src:"/icons/share.svg"})}),t("span",{className:"btn-text",onClick:()=>n.destroy(),children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]})]})}),i("div",{className:"dialog-content-container",ref:g,children:[i("div",{className:"date-card-container",onClick:()=>l(),children:[t("div",{className:"year-text",children:N.getFullYear()}),i("div",{className:"date-container",children:[t("div",{className:"month-text",children:Wt[N.getMonth()]}),t("div",{className:"date-text",children:N.getDate()}),t("div",{className:"day-text",children:Yt[N.getDay()]})]})]}),t(Gt,{className:`date-picker ${c?"":"hidden"}`,datestamp:r,handleDateStampChange:S}),e.isLoading?t("div",{className:"tip-container",children:t("p",{className:"tip-text",children:"\u52AA\u529B\u52A0\u8F7D\u4E2D..."})}):a.length===0?t("div",{className:"tip-container",children:t("p",{className:"tip-text",children:"\u7A7A\u7A7A\u5982\u4E5F"})}):t("div",{className:"dailymemos-wrapper",children:a.map(d=>t(Ht,{memo:d},`${d.id}-${d.updatedAt}`))})]})]})};function zt(n=Date.now()){K({className:"daily-memo-diary-dialog"},Kt,{currentDateStamp:n})}const Jt=()=>{const{memoState:{memos:n,tags:e},userState:{user:a}}=u.exports.useContext($),s=a?a.username:"Memos",r=a?Math.ceil((Date.now()-x.getTimeStampByDate(a.createdAt))/1e3/3600/24):0,[o,c]=u.exports.useState(!1),l=u.exports.useCallback(()=>{A.pushHistory("/"),A.clearQuery()},[]);return i("div",{className:"user-banner-container",children:[i("div",{className:"userinfo-header-container",children:[t("p",{className:"username-text",onClick:l,children:s}),t("span",{className:"action-btn menu-popup-btn",onClick:()=>{const N=document.querySelector(".sidebar-wrapper"),y=document.querySelector(".menu-btns-popup");y.style.top=54-N.scrollTop+"px",c(!0)},children:t("img",{src:"/icons/more.svg",className:"icon-img"})}),t(ft,{shownStatus:o,setShownStatus:c})]}),i("div",{className:"status-text-container",children:[i("div",{className:"status-text memos-text",children:[t("span",{className:"amount-text",children:n.length}),t("span",{className:"type-text",children:"MEMO"})]}),i("div",{className:"status-text tags-text",children:[t("span",{className:"amount-text",children:e.length}),t("span",{className:"type-text",children:"TAG"})]}),i("div",{className:"status-text duration-text",onClick:()=>zt(),children:[t("span",{className:"amount-text",children:r}),t("span",{className:"type-text",children:"DAY"})]})]})]})},Xt=[{text:"\u4E14",value:"AND"},{text:"\u6216",value:"OR"}],te={TAG:{value:"TAG",text:"\u6807\u7B7E",operators:[{text:"\u5305\u62EC",value:"CONTAIN"},{text:"\u6392\u9664",value:"NOT_CONTAIN"}]},TYPE:{value:"TYPE",text:"\u7C7B\u578B",operators:[{value:"IS",text:"\u662F"},{value:"IS_NOT",text:"\u4E0D\u662F"}],values:[{value:"CONNECTED",text:"\u6709\u5173\u8054"},{value:"NOT_TAGGED",text:"\u65E0\u6807\u7B7E"},{value:"LINKED",text:"\u6709\u8D85\u94FE\u63A5"},{value:"IMAGED",text:"\u6709\u56FE\u7247"}]},TEXT:{value:"TEXT",text:"\u6587\u672C",operators:[{value:"CONTAIN",text:"\u5305\u62EC"},{value:"NOT_CONTAIN",text:"\u6392\u9664"}]}},ye=te.TYPE.values,Zt=n=>{for(const e of ye)if(e.value===n)return e.text;return""},en=()=>({type:"TAG",value:{operator:"CONTAIN",value:""},relation:"AND"}),Se=(n,e)=>{let a=!0;for(const s of e){const{relation:r}=s,o=tn(n,s);r==="OR"?a=a||o:a=a&&o}return a},tn=(n,e)=>{const{type:a,value:{operator:s,value:r}}=e;if(r==="")return!0;let o=!0;if(a==="TAG"){let c=n.content.includes(`# ${r}`);s==="NOT_CONTAIN"&&(c=!c),o=c}else if(a==="TYPE"){let c=!1;(r==="NOT_TAGGED"&&n.content.match(Z)===null||r==="LINKED"&&n.content.match(oe)!==null||r==="IMAGED"&&n.content.match(Y)!==null||r==="CONNECTED"&&n.content.match(se)!==null)&&(c=!0),s==="IS_NOT"&&(c=!c),o=c}else if(a==="TEXT"){let c=n.content.includes(r);s==="NOT_CONTAIN"&&(c=!c),o=c}return o};const nn={text:"\u8BF7\u9009\u62E9",value:""},an=n=>{const{className:e,dataSource:a,handleValueChanged:s,value:r}=n,[o,c]=X(!1),l=u.exports.useRef(null);let g=nn;for(const S of a)if(S.value===r){g=S;break}u.exports.useEffect(()=>{if(o){const S=d=>{var h;((h=l.current)==null?void 0:h.contains(d.target))||c(!1)};window.addEventListener("click",S,{capture:!0,once:!0})}},[o]);const N=S=>{s&&s(S.value),c(!1)},y=S=>{S.stopPropagation(),c()};return i("div",{className:`selector-wrapper ${e!=null?e:""}`,ref:l,children:[i("div",{className:`current-value-container ${o?"active":""}`,onClick:y,children:[t("span",{className:"value-text",children:g.text}),t("span",{className:"arrow-text",children:t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),t("div",{className:`items-wrapper ${o?"":"hidden"}`,children:a.map(S=>t("div",{className:`item-container ${S.value===r?"selected":""}`,onClick:()=>{N(S)},children:S.text},S.value))})]})};var re=u.exports.memo(an);const sn=n=>{const{destroy:e,queryId:a}=n,[s,r]=u.exports.useState(""),[o,c]=u.exports.useState([]),l=ee(!1),g=I.getState().memos.filter(m=>Se(m,o)).length;u.exports.useEffect(()=>{const m=V.getQueryById(a!=null?a:"");if(m){r(m.title);const p=JSON.parse(m.querystring);Array.isArray(p)&&c(p)}},[a]);const N=m=>{const p=m.target.value;r(p)},y=async()=>{if(!s){M.error("\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A\uFF01");return}try{if(a){const m=await V.updateQuery(a,s,JSON.stringify(o));V.editQuery(m)}else{const m=await V.createQuery(s,JSON.stringify(o));V.pushQuery(m)}}catch(m){M.error(m.message)}e()},S=()=>{if(o.length>0&&o[o.length-1].value.value===""){M.info("\u5148\u5B8C\u5584\u4E0A\u4E00\u4E2A\u8FC7\u6EE4\u5668\u5427");return}c([...o,en()])},d=u.exports.useCallback((m,p)=>{c(C=>{const f=[...C];return f[m]=p,f})},[]),h=u.exports.useCallback(m=>{c(p=>p.filter((f,E)=>E!==m))},[]);return i(L,{children:[i("div",{className:"dialog-header-container",children:[i("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F516}"}),a?"\u7F16\u8F91\u68C0\u7D22":"\u521B\u5EFA\u68C0\u7D22"]}),t("button",{className:"btn close-btn",onClick:e,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),i("div",{className:"dialog-content-container",children:[i("div",{className:"form-item-container input-form-container",children:[t("span",{className:"normal-text",children:"\u6807\u9898"}),t("input",{className:"title-input",type:"text",value:s,onChange:N})]}),i("div",{className:"form-item-container filter-form-container",children:[t("span",{className:"normal-text",children:"\u8FC7\u6EE4\u5668"}),i("div",{className:"filters-wrapper",children:[o.map((m,p)=>t(rn,{index:p,filter:m,handleFilterChange:d,handleFilterRemove:h},p)),t("div",{className:"create-filter-btn",onClick:S,children:"\u6DFB\u52A0\u7B5B\u9009\u6761\u4EF6"})]})]})]}),i("div",{className:"dialog-footer-container",children:[t("div",{}),i("div",{className:"btns-container",children:[i("span",{className:`tip-text ${o.length===0&&"hidden"}`,children:["\u7B26\u5408\u6761\u4EF6\u7684 Memo \u6709 ",t("strong",{children:g})," \u6761"]}),t("button",{className:`btn save-btn ${l.isLoading?"requesting":""}`,onClick:y,children:"\u4FDD\u5B58"})]})]})]})},rn=u.exports.memo(n=>{const{index:e,filter:a,handleFilterChange:s,handleFilterRemove:r}=n,{type:o}=a,[c,l]=u.exports.useState(t(L,{}));u.exports.useEffect(()=>{let h=t(L,{});Object.keys(te).includes(o)&&(h=t(re,{className:"operator-selector",dataSource:Object.values(te[o].operators),value:a.value.operator,handleValueChanged:y}));let m=t(L,{});switch(o){case"TYPE":{m=t(re,{className:"value-selector",dataSource:te.TYPE.values,value:a.value.value,handleValueChanged:S});break}case"TAG":{m=t(re,{className:"value-selector",dataSource:I.getState().tags.sort().map(p=>({text:p,value:p})),value:a.value.value,handleValueChanged:S});break}case"TEXT":{m=t("input",{type:"text",className:"value-inputer",value:a.value.value,onChange:p=>{S(p.target.value),p.target.focus()}});break}}l(i(L,{children:[h,m]}))},[o,a]);const g=u.exports.useCallback(h=>{["AND","OR"].includes(h)&&s(e,D(b({},a),{relation:h}))},[a]),N=u.exports.useCallback(h=>{if(a.type!==h){const m=Object.values(te[h].operators);s(e,D(b({},a),{type:h,value:{operator:m[0].value,value:""}}))}},[a]),y=u.exports.useCallback(h=>{s(e,D(b({},a),{value:D(b({},a.value),{operator:h})}))},[a]),S=u.exports.useCallback(h=>{s(e,D(b({},a),{value:D(b({},a.value),{value:h})}))},[a]),d=()=>{r(e)};return i("div",{className:"memo-filter-input-wrapper",children:[e>0?t(re,{className:"relation-selector",dataSource:Xt,value:a.relation,handleValueChanged:g}):null,t(re,{className:"type-selector",dataSource:Object.values(te),value:a.type,handleValueChanged:N}),c,t("img",{className:"remove-btn",src:"/icons/close.svg",onClick:d})]})});function Ne(n){K({className:"create-query-dialog"},sn,{queryId:n})}const on=()=>{const{queryState:{queries:n},locationState:{query:{filter:e}}}=u.exports.useContext($),a=ee(),s=n.sort((r,o)=>x.getTimeStampByDate(o.createdAt)-x.getTimeStampByDate(r.createdAt)).sort((r,o)=>{var c,l;return x.getTimeStampByDate((c=o.pinnedAt)!=null?c:0)-x.getTimeStampByDate((l=r.pinnedAt)!=null?l:0)});return u.exports.useEffect(()=>{V.getMyAllQueries().catch(()=>{}).finally(()=>{a.setFinish()})},[]),i("div",{className:"queries-wrapper",children:[i("p",{className:"title-text",children:[t("span",{className:"normal-text",children:"\u5FEB\u901F\u68C0\u7D22"}),t("span",{className:"btn",onClick:()=>Ne(),children:"+"})]}),t(Q,{when:a.isSucceed&&s.length===0,children:t("div",{className:"create-query-btn-container",children:t("span",{className:"btn",onClick:()=>Ne(),children:"\u521B\u5EFA\u68C0\u7D22"})})}),t("div",{className:"queries-container",children:s.map(r=>t(cn,{query:r,isActive:r.id===e},r.id))})]})},cn=n=>{const{query:e,isActive:a}=n,[s,r]=X(!1),[o,c]=X(!1),l=()=>{a?A.setMemoFilter(""):(["/","/recycle"].includes(A.getState().pathname)||A.setPathname("/"),A.setMemoFilter(e.id))},g=m=>{m.stopPropagation(),r()},N=()=>{r(!1)},y=async m=>{if(m.stopPropagation(),o)try{await V.deleteQuery(e.id)}catch(p){M.error(p.message)}else c()},S=m=>{m.stopPropagation(),Ne(e.id)},d=async m=>{m.stopPropagation();try{e.pinnedAt?(await V.unpinQuery(e.id),V.editQuery(D(b({},e),{pinnedAt:void 0}))):(await V.pinQuery(e.id),V.editQuery(D(b({},e),{pinnedAt:x.getDateTimeString(Date.now())})))}catch{}},h=()=>{c(!1)};return t(L,{children:i("div",{className:`query-item-container ${a?"active":""}`,onClick:l,children:[i("div",{className:"query-text-container",children:[t("span",{className:"icon-text",children:"#"}),t("span",{className:"query-text",children:e.title})]}),i("div",{className:"btns-container",children:[t("span",{className:"action-btn toggle-btn",onClick:g,children:t("img",{className:"icon-img",src:`/icons/more${a?"-white":""}.svg`})}),t("div",{className:`action-btns-wrapper ${s?"":"hidden"}`,onMouseLeave:N,children:i("div",{className:"action-btns-container",children:[t("span",{className:"btn",onClick:d,children:e.pinnedAt?"\u53D6\u6D88\u7F6E\u9876":"\u7F6E\u9876"}),t("span",{className:"btn",onClick:S,children:"\u7F16\u8F91"}),t("span",{className:`btn delete-btn ${o?"final-confirm":""}`,onClick:y,onMouseLeave:h,children:o?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"})]})})]})]})})};const ln=()=>{const{locationState:{query:{tag:n}},memoState:{tags:e,memos:a}}=u.exports.useContext($),[s,r]=u.exports.useState([]);return u.exports.useEffect(()=>{I.updateTagsState()},[a]),u.exports.useEffect(()=>{const o=Array.from(e).sort(),c={subTags:[]};for(const l of o){const g=l.split("/");let N=c,y="";for(let S=0;S<g.length;S++){const d=g[S];S===0?y+=d:y+="/"+d;let h=null;for(const m of N.subTags)if(m.text===y){h=m;break}h||(h={key:d,text:y,subTags:[]},N.subTags.push(h)),N=h}}r(c.subTags)},[e]),i("div",{className:"tags-wrapper",children:[t("p",{className:"title-text",children:"\u5E38\u7528\u6807\u7B7E"}),i("div",{className:"tags-container",children:[s.map((o,c)=>t(Be,{tag:o,tagQuery:n},o.text+"-"+c)),t(Q,{when:s.length<5&&I.initialized,children:i("p",{className:"tag-tip-container",children:["\u8F93\u5165",t("span",{className:"code-text",children:"# Tag "}),"\u6765\u521B\u5EFA\u6807\u7B7E\u5427~"]})})]})]})},Be=n=>{const{tag:e,tagQuery:a}=n,s=a===e.text,r=e.subTags.length>0,[o,c]=X(!1),l=()=>{s?A.setTagQuery(""):(x.copyTextToClipboard(`# ${e.text} `),["/","/recycle"].includes(A.getState().pathname)||A.setPathname("/"),A.setTagQuery(e.text))},g=N=>{N.stopPropagation(),c()};return i(L,{children:[i("div",{className:`tag-item-container ${s?"active":""}`,onClick:l,children:[i("div",{className:"tag-text-container",children:[t("span",{className:"icon-text",children:"#"}),t("span",{className:"tag-text",children:e.key})]}),t("div",{className:"btns-container",children:r?t("span",{className:`action-btn toggle-btn ${o?"shown":""}`,onClick:g,children:t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})}):null})]}),r?t("div",{className:`subtags-container ${o?"":"hidden"}`,children:e.subTags.map((N,y)=>t(Be,{tag:N,tagQuery:a},N.text+"-"+y))}):null]})};const Ie={width:12,height:7},Le=(n,e)=>{const a=[];for(let s=1;s<=n;s++)a.push({timestamp:e+W*s,count:0});return a},un=()=>{const n=x.getDateStampByDate(Date.now()),e=new Date(n).getDay()||7,a=new Array(7-e).fill(0),s=(Ie.width-1)*Ie.height+e,r=n-s*W,{memoState:{memos:o}}=u.exports.useContext($),[c,l]=u.exports.useState(Le(s,r)),[g,N]=u.exports.useState(null),[y,S]=u.exports.useState(null),d=u.exports.useRef(null),h=u.exports.useRef(null);u.exports.useEffect(()=>{const f=Le(s,r);for(const E of o){const v=(x.getDateStampByDate(E.createdAt)-r)/(1e3*3600*24)-1;v>=0&&(f[v].count+=1)}l([...f])},[o]);const m=u.exports.useCallback((f,E)=>{var G,F;if(N(E),!h.current)return;const{isMobileView:v}=R.getState(),k=f.target,w=document.querySelector(".sidebar-wrapper");h.current.style.left=k.offsetLeft-((F=(G=d.current)==null?void 0:G.offsetLeft)!=null?F:0)+"px";let O=k.offsetTop;v||(O-=w.scrollTop),h.current.style.top=O+"px"},[]),p=u.exports.useCallback(()=>{N(null)},[]),C=u.exports.useCallback(f=>{var E;((E=A.getState().query.duration)==null?void 0:E.from)===f.timestamp?(A.setFromAndToQuery(0,0),S(null)):f.count>0&&(["/","/recycle"].includes(A.getState().pathname)||A.setPathname("/"),A.setFromAndToQuery(f.timestamp,f.timestamp+W),S(f))},[]);return i("div",{className:"usage-heat-map-wrapper",ref:d,children:[i("div",{className:"day-tip-text-container",children:[t("span",{className:"tip-text",children:"Mon"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Wed"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Fri"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Sun"})]}),i("div",{ref:h,className:"usage-detail-container pop-up "+(g?"":"hidden"),children:[g==null?void 0:g.count," memos on ",t("span",{className:"date-text",children:new Date(g==null?void 0:g.timestamp).toDateString()})]}),i("div",{className:"usage-heat-map",children:[c.map((f,E)=>{const v=f.count,k=v<=0?"":v<=1?"stat-day-L1-bg":v<=2?"stat-day-L2-bg":v<=4?"stat-day-L3-bg":"stat-day-L4-bg";return t("span",{className:`stat-container ${k} ${y===f?"current":""} ${n===f.timestamp?"today":""}`,onMouseEnter:w=>m(w,f),onMouseLeave:p,onClick:()=>C(f)},E)}),a.map((f,E)=>t("span",{className:"stat-container null"},E))]})]})};const dn=()=>{const{locationState:n,globalState:{isMobileView:e,showSiderbarInMobileView:a}}=u.exports.useContext($),s=u.exports.useRef(null),r=u.exports.useMemo(()=>o=>{var l,g,N;const c=R.getState().showSiderbarInMobileView;if(!c){window.removeEventListener("click",r,{capture:!0});return}((l=s.current)==null?void 0:l.contains(o.target))||((N=(g=s.current)==null?void 0:g.parentNode)==null?void 0:N.contains(o.target))&&(c&&o.stopPropagation(),R.setShowSiderbarInMobileView(!1),window.removeEventListener("click",r,{capture:!0}))},[]);return u.exports.useEffect(()=>{R.setShowSiderbarInMobileView(!1)},[n]),u.exports.useEffect(()=>{a?document.body.classList.add(ve):document.body.classList.remove(ve)},[a]),u.exports.useEffect(()=>{e&&a&&window.addEventListener("click",r,{capture:!0})},[e,a]),i("aside",{className:"sidebar-wrapper",ref:s,children:[t(Jt,{}),t(un,{}),t(on,{}),t(ln,{})]})};function mn(){const{locationState:{pathname:n}}=u.exports.useContext($),e=ee();return u.exports.useEffect(()=>{const{user:a}=U.getState();a?e.setFinish():U.doSignIn().catch(()=>{}).finally(()=>{U.getState().user?e.setFinish():A.replaceHistory("/signin")})},[]),t(L,{children:e.isLoading?null:i("section",{id:"page-wrapper",children:[t(dn,{}),t("main",{className:"content-wrapper",children:_n(n)})]})})}const hn=/[\u3000\u3400-\u4DBF\u4E00-\u9FFF]/;function ce(n,e){return e.minLength!==void 0&&n.length<e.minLength?{result:!1,reason:"\u957F\u5EA6\u8FC7\u77ED"}:e.maxLength!==void 0&&n.length>e.maxLength?{result:!1,reason:"\u957F\u5EA6\u8D85\u51FA"}:e.noSpace&&n.includes(" ")?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u7A7A\u683C"}:e.noChinese&&hn.test(n)?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u4E2D\u6587\u5B57\u7B26"}:{result:!0}}const Oe={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},pn=()=>{const[n,e]=u.exports.useState(""),[a,s]=u.exports.useState(""),[r,o]=u.exports.useState(!0),c=ee(!1),l=u.exports.useRef(null),g=u.exports.useRef(null);u.exports.useEffect(()=>{const p=C=>{var f,E;C.key==="Enter"&&((f=l.current)==null||f.click(),(E=g.current)==null||E.click())};return document.body.addEventListener("keypress",p),()=>{document.body.removeEventListener("keypress",p)}},[]);const N=p=>{const C=p.target.value;e(C)},y=p=>{const C=p.target.value;s(C)},S=()=>{De()},d=async()=>{if(c.isLoading)return;const p=ce(n,Oe);if(!p.result){M.error("\u7528\u6237\u540D "+p.reason);return}const C=ce(a,Oe);if(!C.result){M.error("\u5BC6\u7801 "+C.reason);return}try{c.setLoading();const f=_.signin,{succeed:E,message:v}=await f(n,a);if(!E&&v){M.error("\u{1F61F} "+v);return}await U.doSignIn()?A.replaceHistory("/"):M.error("\u{1F61F} \u767B\u5F55\u5931\u8D25")}catch(f){console.error(f),M.error("\u{1F61F} "+f.message)}c.setFinish()},h=()=>{c.isLoading||o(!1)},m=async()=>{if(!c.isLoading){try{c.setLoading();const{succeed:p,message:C}=await _.signin("guest","123456");if(!p&&C){M.error("\u{1F61F} "+C);return}await U.doSignIn()?A.replaceHistory("/"):M.error("\u{1F61F} \u767B\u5F55\u5931\u8D25")}catch(p){console.error(p),M.error("\u{1F61F} "+p.message)}c.setFinish()}};return t("div",{className:"page-wrapper signin",children:i("div",{className:"page-container",children:[t("div",{className:"page-header-container",children:i("p",{className:"title-text",children:["\u767B\u5F55 Memos ",t("span",{className:"icon-text",children:"\u270D\uFE0F"})]})}),r?i(L,{children:[i("div",{className:"quickly-btns-container",children:[t("div",{ref:l,className:`btn guest-signin ${c.isLoading?"requesting":""}`,onClick:m,children:"\u{1F449} \u5FEB\u901F\u767B\u5F55\u8FDB\u884C\u4F53\u9A8C"}),t("div",{className:`btn ${c.isLoading?"requesting":""}`,onClick:h,children:"\u5DF2\u6709\u8D26\u53F7\uFF0C\u6211\u8981\u81EA\u5DF1\u767B\u5F55"})]}),i("p",{className:"tip-text",children:["\u4EC5\u7528\u4E8E\u4F5C\u54C1\u5C55\u793A\u3002",t("br",{}),i("span",{className:"btn",onClick:S,children:[t("span",{className:"icon-text",children:"\u{1F920}"}),"\u5173\u4E8E\u672C\u7AD9"]})]})]}):i(L,{children:[i("div",{className:"page-content-container",children:[i("div",{className:"form-item-container input-form-container",children:[t("span",{className:"normal-text "+(n===""?"":"not-null"),children:"\u8D26\u53F7"}),t("input",{type:"text",autoComplete:"off",value:n,onChange:N})]}),i("div",{className:"form-item-container input-form-container",children:[t("span",{className:"normal-text "+(a===""?"":"not-null"),children:"\u5BC6\u7801"}),t("input",{type:"password",autoComplete:"off",value:a,onChange:y})]})]}),i("div",{className:"page-footer-container",children:[t("div",{className:"btns-container",children:t(Q,{when:window.location.origin.includes("justsven.top"),children:t("a",{className:"btn-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"Sign In with GitHub"})})}),i("div",{className:"btns-container",children:[t("button",{className:`btn ${c.isLoading?"requesting":""}`,onClick:m,children:"\u4F53\u9A8C\u4E00\u4E0B"}),t("span",{className:"split-text",children:"/"}),t("button",{className:"btn signup-btn disabled",onClick:()=>M.info("\u6CE8\u518C\u5DF2\u5173\u95ED"),children:"\u6CE8\u518C"}),t("span",{className:"split-text",children:"/"}),t("button",{className:`btn signin-btn ${c.isLoading?"requesting":""}`,ref:g,onClick:d,children:"\u767B\u5F55"})]})]})]})]})})},gn={"/signin":t(pn,{}),"*":t(mn,{})};function fn(){const[n,e]=u.exports.useState(!1);return u.exports.useCallback(()=>{e(s=>!s)},[])}const yn=u.exports.forwardRef((n,e)=>{var v,k;const{globalState:{useTinyUndoHistoryCache:a}}=u.exports.useContext($),{className:s,initialContent:r,placeholder:o,showConfirmBtn:c,showCancelBtn:l,showTools:g,onConfirmBtnClick:N,onCancelBtnClick:y,onContentChange:S}=n,d=u.exports.useRef(null),h=u.exports.useRef(null),m=fn();u.exports.useEffect(()=>{r&&(d.current.value=r,m())},[]),u.exports.useEffect(()=>{var w;if(a){const{tinyUndoActionsCache:O,tinyUndoIndexCache:G}=j.get(["tinyUndoActionsCache","tinyUndoIndexCache"]);return h.current=new We(d.current,{interval:5e3,initialActions:O,initialIndex:G}),h.current.subscribe((F,q)=>{j.set({tinyUndoActionsCache:F,tinyUndoIndexCache:q})}),()=>{var F;(F=h.current)==null||F.destroy()}}else(w=h.current)==null||w.destroy(),h.current=null,j.remove(["tinyUndoActionsCache","tinyUndoIndexCache"])},[a]),u.exports.useEffect(()=>{var w;d.current&&(d.current.style.height="auto",d.current.style.height=((w=d.current.scrollHeight)!=null?w:0)+"px")},[(v=d.current)==null?void 0:v.value]),u.exports.useImperativeHandle(e,()=>({focus:()=>{d.current.focus()},insertText:w=>{const O=d.current.value;d.current.value=O+w,S(d.current.value),m()},setContent:w=>{d.current.value=w,m()},getContent:()=>{var w,O;return(O=(w=d.current)==null?void 0:w.value)!=null?O:""}}),[]);const p=u.exports.useCallback(()=>{S(d.current.value),m()},[]),C=u.exports.useCallback(w=>{w.stopPropagation(),w.code==="Enter"&&(w.metaKey||w.ctrlKey)&&f(),m()},[]),f=u.exports.useCallback(()=>{var w;N(d.current.value),d.current.value="",m(),(w=h.current)==null||w.resetState()},[]),E=u.exports.useCallback(()=>{y()},[]);return i("div",{className:"common-editor-wrapper "+s,children:[t("textarea",{className:"common-editor-inputer",rows:1,placeholder:o,ref:d,onInput:p,onKeyDown:C}),i("div",{className:"common-tools-wrapper",children:[t(Q,{when:g,children:t("div",{className:"common-tools-container"})}),i("div",{className:"btns-container",children:[t(Q,{when:l,children:t("button",{className:"action-btn cancel-btn",onClick:E,children:"\u64A4\u9500\u4FEE\u6539"})}),t(Q,{when:c,children:i("button",{className:"action-btn confirm-btn",disabled:!((k=d.current)==null?void 0:k.value),onClick:f,children:["\u8BB0\u4E0B",t("span",{className:"icon-text",children:"\u270D\uFE0F"})]})})]})]})]})});const _e=n=>{const{className:e,editMemoId:a}=n,{globalState:s}=u.exports.useContext($),r=u.exports.useRef(null);u.exports.useEffect(()=>{var y,S;if(s.markMemoId&&(a===s.editMemoId||!a&&!s.editMemoId)){const h=`${((y=r.current)==null?void 0:y.getContent())?`
`:""}Mark: [@MEMO](${s.markMemoId})`;(S=r.current)==null||S.insertText(h),R.setMarkMemoId("")}},[s.markMemoId]),u.exports.useEffect(()=>{var y,S,d;if(a){const h=I.getMemoById(a);h&&((S=r.current)==null||S.setContent((y=h.content)!=null?y:""),(d=r.current)==null||d.focus())}},[a]);const o=u.exports.useCallback(async y=>{if(y===""){M.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u5440");return}y=y.replaceAll("&nbsp;"," ");try{if(a){const S=I.getMemoById(a);if(S&&S.content!==y){const d=await I.updateMemo(S.id,y);d.updatedAt=x.getDateTimeString(Date.now()),I.editMemo(d)}R.setEditMemoId("")}else{const S=await I.createMemo(y);I.pushMemo(S),A.clearQuery()}}catch(S){M.error(S.message)}Ee("")},[]),c=u.exports.useCallback(()=>{var y;R.setEditMemoId(""),(y=r.current)==null||y.setContent(""),Ee("")},[]),l=u.exports.useCallback(y=>{const S=document.createElement("div");S.innerHTML=y,S.innerText.trim()===""&&(y=""),Ee(y)},[]),g=Boolean(a),N=u.exports.useMemo(()=>({className:"memo-editor",initialContent:Sn(),placeholder:"\u73B0\u5728\u7684\u60F3\u6CD5\u662F...",showConfirmBtn:!0,showCancelBtn:g,showTools:!0,onConfirmBtnClick:o,onCancelBtnClick:c,onContentChange:l}),[a]);return i("div",{className:`memo-editor-wrapper ${e} ${a?"edit-ing":""}`,children:[t("p",{className:"tip-text "+(a?"":"hidden"),children:"\u6B63\u5728\u4FEE\u6539\u4E2D..."}),t(yn,b({ref:r},N))]})};function Sn(){var n;return(n=j.get(["editorContentCache"]).editorContentCache)!=null?n:""}function Ee(n){j.set({editorContentCache:n})}const Nn=()=>{const{locationState:{query:{type:n}}}=u.exports.useContext($),e=s=>{const{type:r}=A.getState().query;s===r&&(s=""),A.setMemoTypeQuery(s)};return i("div",{className:"search-bar-container",children:[i("div",{className:"search-bar-inputer",children:[t("img",{className:"icon-img",src:"/icons/search.svg"}),t("input",{className:"text-input",type:"text",placeholder:"",onChange:s=>{const r=s.currentTarget.value;A.setTextQuery(r)}})]}),t("div",{className:"quickly-action-wrapper",children:i("div",{className:"quickly-action-container",children:[t("p",{className:"title-text",children:"QUICKLY FILTER"}),i("div",{className:"section-container types-container",children:[t("span",{className:"section-text",children:"\u7C7B\u578B:"}),t("div",{className:"values-container",children:ye.map((s,r)=>i("div",{children:[t("span",{className:`type-item ${n===s.value?"selected":""}`,onClick:()=>{e(s.value)},children:s.text}),r+1<ye.length?t("span",{className:"split-text",children:"/"}):null]},s.value))})]})]})})]})};let Ue=Date.now();const En=()=>{const{locationState:{query:{filter:n}},globalState:{isMobileView:e},queryState:{queries:a}}=u.exports.useContext($),[s,r]=u.exports.useState("MEMOS");u.exports.useEffect(()=>{const l=V.getQueryById(n);r(l?l.title:"MEMOS")},[n,a]);const o=u.exports.useCallback(()=>{const l=Date.now();l-Ue>10*1e3&&(Ue=l,I.fetchAllMemos().catch(()=>{}))},[]),c=u.exports.useCallback(()=>{R.setShowSiderbarInMobileView(!0)},[]);return i("div",{className:"section-header-container memos-header-container",children:[i("div",{className:"title-text",onClick:o,children:[t(Q,{when:e,children:t("button",{className:"action-btn",onClick:c,children:t("img",{className:"icon-img",src:"/icons/menu.svg",alt:"menu"})})}),t("span",{className:"normal-text",children:s})]}),t(Nn,{})]})};const Re=()=>{const{locationState:{query:n}}=u.exports.useContext($),{tag:e,duration:a,type:s,text:r,filter:o}=n,c=V.getQueryById(o),l=Boolean(e||a&&a.from<a.to||s||r||c);return i("div",{className:`filter-query-container ${l?"":"hidden"}`,children:[t("span",{className:"tip-text",children:"\u7B5B\u9009\uFF1A"}),i("div",{className:"filter-item-container "+(c?"":"hidden"),onClick:()=>{A.setMemoFilter("")},children:[t("span",{className:"icon-text",children:"\u{1F516}"})," ",c==null?void 0:c.title]}),i("div",{className:"filter-item-container "+(e?"":"hidden"),onClick:()=>{A.setTagQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F3F7}\uFE0F"})," ",e]}),i("div",{className:"filter-item-container "+(s?"":"hidden"),onClick:()=>{A.setMemoTypeQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F4E6}"})," ",Zt(s)]}),a&&a.from<a.to?i("div",{className:"filter-item-container",onClick:()=>{A.setFromAndToQuery(0,0)},children:[t("span",{className:"icon-text",children:"\u{1F5D3}\uFE0F"})," ",x.getDateString(a.from)," \u81F3 ",x.getDateString(a.to)]}):null,i("div",{className:"filter-item-container "+(r?"":"hidden"),onClick:()=>{A.setTextQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F50D}"})," ",r]})]})};const Cn=()=>{const{locationState:{query:n},memoState:{memos:e},globalState:a}=u.exports.useContext($),[s,r]=u.exports.useState(!0),o=u.exports.useRef(null),{tag:c,duration:l,type:g,text:N,filter:y}=n,S=Boolean(c||l&&l.from<l.to||g||N),d=S||y?e.filter(m=>{let p=!0;const C=V.getQueryById(y);if(C){const f=JSON.parse(C.querystring);Array.isArray(f)&&(p=Se(m,f))}return c&&!m.content.includes(`# ${c}`)&&(p=!1),l&&l.from<l.to&&(x.getTimeStampByDate(m.createdAt)<l.from||x.getTimeStampByDate(m.createdAt)>l.to)&&(p=!1),g&&(g==="NOT_TAGGED"&&m.content.match(Z)!==null||g==="LINKED"&&m.content.match(oe)===null||g==="IMAGED"&&m.content.match(Y)===null||g==="CONNECTED"&&m.content.match(se)===null)&&(p=!1),N&&!m.content.includes(N)&&(p=!1),p}):e;u.exports.useEffect(()=>{I.fetchAllMemos().then(()=>{r(!1)}).catch(()=>{M.error("\u{1F62D} \u8BF7\u6C42\u6570\u636E\u5931\u8D25\u4E86")})},[]),u.exports.useEffect(()=>{var m;(m=o.current)==null||m.scrollTo({top:0})},[n]);const h=u.exports.useCallback(m=>{const p=m.target;if(p.tagName==="SPAN"&&p.className==="tag-span"){const C=p.innerText.slice(1);A.getState().query.tag===C?A.setTagQuery(""):A.setTagQuery(C)}},[]);return i("div",{className:`memolist-wrapper ${s?"":"completed"}`,onClick:h,ref:o,children:[d.map(m=>a.editMemoId===m.id?t(_e,{className:"memo-edit",editMemoId:m.id},m.id):t(Vt,{memo:m},`${m.id}-${m.updatedAt}`)),t("div",{className:"status-text-container",children:t("p",{className:"status-text",children:s?"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...":d.length===0?"\u7A7A\u7A7A\u5982\u4E5F":S?"":"\u6240\u6709\u6570\u636E\u52A0\u8F7D\u5B8C\u5566 \u{1F389}"})})]})};function bn(){return i(L,{children:[t(En,{}),t(_e,{}),t(Re,{}),t(Cn,{})]})}const xn=n=>{var y,S;const{memo:e,handleDeletedMemoAction:a}=n,s=D(b({},e),{createdAtStr:x.getDateTimeString(e.createdAt),deletedAtStr:x.getDateTimeString((y=e.deletedAt)!=null?y:Date.now())}),[r,o]=X(!1),c=Array.from((S=s.content.match(Y))!=null?S:[]),l=async()=>{if(r)try{await I.deleteMemoById(s.id),a(s.id)}catch(d){M.error(d.message)}else o()},g=async()=>{try{await I.restoreMemoById(s.id),a(s.id),M.info("\u6062\u590D\u6210\u529F")}catch(d){M.error(d.message)}},N=()=>{r&&o(!1)};return i("div",{className:`memo-wrapper ${"memos-"+s.id}`,onMouseLeave:N,children:[i("div",{className:"memo-top-wrapper",children:[i("span",{className:"time-text",children:["\u5220\u9664\u4E8E ",s.deletedAtStr]}),i("div",{className:"btns-container",children:[t("span",{className:"btn more-action-btn",children:t("img",{className:"icon-img",src:"/icons/more.svg"})}),t("div",{className:"more-action-btns-wrapper",children:i("div",{className:"more-action-btns-container",children:[t("span",{className:"btn restore-btn",onClick:g,children:"\u6062\u590D"}),t("span",{className:`btn delete-btn ${r?"final-confirm":""}`,onClick:l,children:r?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5B8C\u5168\u5220\u9664"})]})})]})]}),t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:z(s.content)}}),t(Q,{when:c.length>0,children:t("div",{className:"images-wrapper",children:c.map((d,h)=>t(ge,{className:"memo-img",imgUrl:d},h))})})]})};const vn=()=>{const{locationState:{query:n},globalState:{isMobileView:e}}=u.exports.useContext($),a=ee(),[s,r]=u.exports.useState([]),{tag:o,duration:c,type:l,text:g,filter:N}=n,y=V.getQueryById(N),d=Boolean(o||c&&c.from<c.to||l||g||y)||y?s.filter(p=>{let C=!0;if(y){const f=JSON.parse(y.querystring);Array.isArray(f)&&(C=Se(p,f))}return o&&!p.content.includes(`# ${o}`)&&(C=!1),c&&c.from<c.to&&(x.getTimeStampByDate(p.createdAt)<c.from||x.getTimeStampByDate(p.createdAt)>c.to)&&(C=!1),l&&(l==="NOT_TAGGED"&&p.content.match(Z)!==null||l==="LINKED"&&p.content.match(oe)===null||l==="IMAGED"&&p.content.match(Y)===null||l==="CONNECTED"&&p.content.match(se)===null)&&(C=!1),g&&!p.content.includes(g)&&(C=!1),C}):s;u.exports.useEffect(()=>{I.fetchAllMemos(),I.fetchDeletedMemos().then(p=>{p!==!1&&r(p)}).catch(p=>{M.error("Failed to fetch deleted memos: ",p)}).finally(()=>{a.setFinish()}),A.clearQuery()},[]);const h=u.exports.useCallback(p=>{r(C=>C.filter(f=>f.id!==p))},[]),m=u.exports.useCallback(()=>{R.setShowSiderbarInMobileView(!0)},[]);return i("div",{className:"memo-trash-wrapper",children:[t("div",{className:"section-header-container",children:i("div",{className:"title-text",children:[t(Q,{when:e,children:t("button",{className:"action-btn",onClick:m,children:t("img",{className:"icon-img",src:"/icons/menu.svg",alt:"menu"})})}),t("span",{className:"normal-text",children:"\u56DE\u6536\u7AD9"})]})}),t(Re,{}),a.isLoading?t("div",{className:"tip-text-container",children:t("p",{className:"tip-text",children:"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D..."})}):s.length===0?t("div",{className:"tip-text-container",children:t("p",{className:"tip-text",children:"Here is No Zettels."})}):t("div",{className:"deleted-memos-container",children:d.map(p=>t(xn,{memo:p,handleDeletedMemoAction:h},`${p.id}-${p.updatedAt}`))})]})};const wn={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},Dn=({destroy:n})=>{const[e,a]=u.exports.useState(""),[s,r]=u.exports.useState(""),[o,c]=u.exports.useState("");u.exports.useEffect(()=>{},[]);const l=()=>{n()},g=d=>{const h=d.target.value;a(h)},N=d=>{const h=d.target.value;r(h)},y=d=>{const h=d.target.value;c(h)},S=async()=>{if(e===""||s===""||o===""){M.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(s!==o){M.error("\u65B0\u5BC6\u7801\u4E24\u6B21\u8F93\u5165\u4E0D\u4E00\u81F4"),c("");return}const d=ce(s,wn);if(!d.result){M.error("\u5BC6\u7801 "+d.reason);return}try{if(!await U.checkPasswordValid(e)){M.error("\u65E7\u5BC6\u7801\u4E0D\u5339\u914D"),a("");return}await U.updatePassword(s),M.info("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF01"),l()}catch(h){M.error(h)}};return i(L,{children:[i("div",{className:"dialog-header-container",children:[t("p",{className:"title-text",children:"\u4FEE\u6539\u5BC6\u7801"}),t("button",{className:"btn close-btn",onClick:l,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),i("div",{className:"dialog-content-container",children:[i("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text "+(e===""?"":"not-null"),children:"\u65E7\u5BC6\u7801"}),t("input",{type:"password",value:e,onChange:g})]}),i("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text "+(s===""?"":"not-null"),children:"\u65B0\u5BC6\u7801"}),t("input",{type:"password",value:s,onChange:N})]}),i("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text "+(o===""?"":"not-null"),children:"\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801"}),t("input",{type:"password",value:o,onChange:y})]}),i("div",{className:"btns-container",children:[t("span",{className:"btn cancel-btn",onClick:l,children:"\u53D6\u6D88"}),t("span",{className:"btn confirm-btn",onClick:S,children:"\u4FDD\u5B58"})]})]})]})};function Fn(){K({className:"change-password-dialog"},Dn)}const Mn=({destroy:n})=>{const[e,a]=u.exports.useState("");u.exports.useEffect(()=>{},[]);const s=()=>{n()},r=c=>{const l=c.target.value;a(l)},o=async()=>{if(e===""){M.error("\u5FAE\u4FE1 id \u4E0D\u80FD\u4E3A\u7A7A");return}try{await U.updateWxUserId(e),U.doSignIn(),M.info("\u7ED1\u5B9A\u6210\u529F\uFF01"),s()}catch(c){M.error(c)}};return i(L,{children:[i("div",{className:"dialog-header-container",children:[t("p",{className:"title-text",children:"\u7ED1\u5B9A\u5FAE\u4FE1 OpenID"}),t("button",{className:"btn close-btn",onClick:s,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),i("div",{className:"dialog-content-container",children:[i("p",{className:"tip-text",children:["\u5173\u6CE8\u5FAE\u4FE1\u516C\u4F17\u53F7\u201C\u5C0F\u8C08\u95F2\u4E8B\u201D\uFF0C\u4E3B\u52A8\u53D1\u9001\u4EFB\u610F\u6D88\u606F\uFF0C\u5373\u53EF\u83B7\u53D6 ",t("strong",{children:"OpenID"})," \u3002"]}),i("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text "+(e===""?"":"not-null"),children:"\u5FAE\u4FE1 OpenID"}),t("input",{type:"text",value:e,onChange:r})]}),i("div",{className:"btns-container",children:[t("span",{className:"btn cancel-btn",onClick:s,children:"\u53D6\u6D88"}),t("span",{className:"btn confirm-btn",onClick:o,children:"\u4FDD\u5B58"})]})]})]})};function Tn(){K({className:"bind-wxid-dialog"},Mn)}const kn={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},An=()=>{const{userState:n}=u.exports.useContext($),e=n.user,[a,s]=u.exports.useState(e.username),[r,o]=u.exports.useState(!1),[c,l]=u.exports.useState(!1),[g,N]=u.exports.useState(!1),y=C=>{const f=C.target.value;s(f)},S=async()=>{if(e.username==="guest"){M.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u7528\u6237\u540D");return}if(a===e.username){o(!1);return}const C=ce(a,kn);if(!C.result){M.error("\u7528\u6237\u540D "+C.reason);return}try{if(!await U.checkUsernameUsable(a)){M.error("\u7528\u6237\u540D\u65E0\u6CD5\u4F7F\u7528");return}await U.updateUsername(a),await U.doSignIn(),o(!1),M.info("\u4FEE\u6539\u6210\u529F~")}catch(f){M.error(f.message)}},d=()=>{if(e.username==="guest"){M.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u5BC6\u7801");return}Fn()},h=async()=>{if(c){try{await U.removeGithubName(),await U.doSignIn()}catch(C){M.error(C.message)}l(!1)}else l(!0)},m=async()=>{if(g){try{await U.updateWxUserId(""),await U.doSignIn()}catch(C){M.error(C.message)}N(!1)}else N(!0)},p=C=>{C.preventDefault()};return i(L,{children:[i("div",{className:"section-container account-section-container",children:[t("p",{className:"title-text",children:"\u57FA\u672C\u4FE1\u606F"}),i("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"ID\uFF1A"}),t("span",{className:"normal-text",children:e.id})]}),i("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"\u521B\u5EFA\u65F6\u95F4\uFF1A"}),t("span",{className:"normal-text",children:x.getDateString(e.createdAt)})]}),i("label",{className:"form-label input-form-label username-label",children:[t("span",{className:"normal-text",children:"\u8D26\u53F7\uFF1A"}),t("input",{type:"text",readOnly:!r,value:a,onClick:()=>{o(!0)},onChange:y}),i("div",{className:"btns-container",onClick:p,children:[t("span",{className:"btn confirm-btn "+(r?"":"hidden"),onClick:S,children:"\u4FDD\u5B58"}),t("span",{className:"btn cancel-btn "+(r?"":"hidden"),onClick:()=>{s(e.username),o(!1)},children:"\u64A4\u9500"})]})]}),i("label",{className:"form-label password-label",children:[t("span",{className:"normal-text",children:"\u5BC6\u7801\uFF1A"}),t("span",{className:"btn",onClick:d,children:"\u4FEE\u6539\u5BC6\u7801"})]})]}),t(Q,{when:window.location.origin.includes("justsven.top"),children:i("div",{className:"section-container connect-section-container",children:[t("p",{className:"title-text",children:"\u5173\u8054\u8D26\u53F7"}),i("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"\u5FAE\u4FE1 OpenID\uFF1A"}),e.wxUserId?i(L,{children:[t("span",{className:"value-text",children:"************"}),t("span",{className:`btn-text unbind-btn ${g?"final-confirm":""}`,onMouseLeave:()=>N(!1),onClick:m,children:g?"\u786E\u5B9A\u53D6\u6D88\u7ED1\u5B9A\uFF01":"\u53D6\u6D88\u7ED1\u5B9A"})]}):i(L,{children:[t("span",{className:"value-text",children:"\u7A7A"}),t("span",{className:"btn-text bind-btn",onClick:()=>{Tn()},children:"\u7ED1\u5B9A ID"})]})]}),i("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"GitHub\uFF1A"}),e.githubName?i(L,{children:[t("a",{className:"value-text",href:"https://github.com/"+e.githubName,children:e.githubName}),t("span",{className:`btn-text unbind-btn ${c?"final-confirm":""}`,onMouseLeave:()=>l(!1),onClick:h,children:c?"\u786E\u5B9A\u53D6\u6D88\u7ED1\u5B9A\uFF01":"\u53D6\u6D88\u7ED1\u5B9A"})]}):i(L,{children:[t("span",{className:"value-text",children:"\u7A7A"}),t("a",{className:"btn-text link-btn",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"\u524D\u5F80\u7ED1\u5B9A"})]})]})]})})]})};const Bn=()=>{const{globalState:n}=u.exports.useContext($),{useTinyUndoHistoryCache:e,shouldHideImageUrl:a,shouldSplitMemoWord:s,shouldUseMarkdownParser:r}=n,o=`\u{1F44B} \u4F60\u597D\u5440\uFF5E
\u6211\u662F\u4E00\u4E2Ademo\uFF1A
* \u{1F44F} \u6B22\u8FCE\u4F7F\u7528memos\uFF1B`,c=()=>{R.setAppSetting({useTinyUndoHistoryCache:!e})},l=()=>{R.setAppSetting({shouldSplitMemoWord:!s})},g=()=>{R.setAppSetting({shouldHideImageUrl:!a})},N=()=>{R.setAppSetting({shouldUseMarkdownParser:!r})},y=async()=>{const d=I.getState().memos.map(p=>b({},p)),h=JSON.stringify(d),m=document.createElement("a");m.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(h)),m.setAttribute("download","data.json"),m.style.display="none",document.body.appendChild(m),m.click(),document.body.removeChild(m)},S=async()=>{const d=I.getState().memos;for(const h of d)I.updateMemo(h.id,pe(h.content))};return i(L,{children:[i("div",{className:"section-container preferences-section-container",children:[t("p",{className:"title-text",children:"Memo \u663E\u793A\u76F8\u5173"}),t("div",{className:"demo-content-container memo-content-text",dangerouslySetInnerHTML:{__html:z(o)}}),i("label",{className:"form-label checkbox-form-label",onClick:l,children:[t("span",{className:"normal-text",children:"\u4E2D\u82F1\u6587\u5185\u5BB9\u81EA\u52A8\u95F4\u9694"}),t("img",{className:"icon-img",src:s?"/icons/checkbox-active.svg":"/icons/checkbox.svg"})]}),i("label",{className:"form-label checkbox-form-label",onClick:N,children:[t("span",{className:"normal-text",children:"\u90E8\u5206 markdown \u683C\u5F0F\u89E3\u6790"}),t("img",{className:"icon-img",src:r?"/icons/checkbox-active.svg":"/icons/checkbox.svg"})]}),i("label",{className:"form-label checkbox-form-label",onClick:g,children:[t("span",{className:"normal-text",children:"\u9690\u85CF\u56FE\u7247\u94FE\u63A5\u5730\u5740"}),t("img",{className:"icon-img",src:a?"/icons/checkbox-active.svg":"/icons/checkbox.svg"})]})]}),i("div",{className:"section-container preferences-section-container",children:[t("p",{className:"title-text",children:"\u7F16\u8F91\u5668"}),i("label",{className:"form-label checkbox-form-label",onClick:c,children:[i("span",{className:"normal-text",children:["\u542F\u7528"," ",t("a",{target:"_blank",href:"https://github.com/boojack/tiny-undo",onClick:d=>d.stopPropagation(),children:"tiny-undo"})]}),t("img",{className:"icon-img",src:e?"/icons/checkbox-active.svg":"/icons/checkbox.svg"})]})]}),i("div",{className:"section-container hidden",children:[t("p",{className:"title-text",children:"\u5176\u4ED6"}),i("div",{className:"btn-container",children:[t("button",{className:"btn export-btn",onClick:y,children:"\u5BFC\u51FA\u6570\u636E(JSON)"}),t("button",{className:"btn format-btn",onClick:S,children:"\u683C\u5F0F\u5316\u6570\u636E"})]})]})]})};const In=()=>{const{globalState:{isMobileView:n}}=u.exports.useContext($);u.exports.useEffect(()=>{I.fetchAllMemos()},[]);const e=u.exports.useCallback(()=>{R.setShowSiderbarInMobileView(!0)},[]);return i("div",{className:"preference-wrapper",children:[t("div",{className:"section-header-container",children:i("div",{className:"title-text",children:[t(Q,{when:n,children:t("button",{className:"action-btn",onClick:e,children:t("img",{className:"icon-img",src:"/icons/menu.svg",alt:"menu"})})}),t("span",{className:"normal-text",children:"\u8D26\u53F7\u4E0E\u8BBE\u7F6E"})]})}),i("div",{className:"sections-wrapper",children:[t(An,{}),t(Bn,{})]})]})},Ln={"/recycle":t(vn,{}),"/setting":t(In,{}),"*":t(bn,{})},$e=n=>e=>{for(const a of Object.keys(n))if(a===e)return n[a];return n["*"]},On=$e(gn),_n=$e(Ln);function Un(){const{locationState:{pathname:n}}=u.exports.useContext($);return u.exports.useEffect(()=>{const e=()=>{R.setIsMobileView(document.body.clientWidth<=875)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),t(L,{children:On(n)})}(()=>{String.prototype.replaceAll||(String.prototype.replaceAll=function(n,e){return Object.prototype.toString.call(n).toLowerCase()==="[object regexp]"?this.replace(n,e):this.replace(new RegExp(n,"g"),e)})})();ae.render(t(Ye.StrictMode,{children:t(xe,{store:T,context:$,children:t(Un,{})})}),document.getElementById("root"));
